---
# Setup gpg and allows preset passphrase
- name: Create directory
  ansible.builtin.file:
    path: "{{ ansible_user_dir }}/.gnupg"
    state: directory
    mode: '0700'

- name: Create gpg config file
  ansible.builtin.copy:
    src: gpg-agent.conf
    dest: "{{ ansible_user_dir }}/.gnupg/gpg-agent.conf"
    mode: '0600'

- name: Setup GPG_TTY variable
  ansible.builtin.lineinfile:
    path: "{{ ansible_user_dir }}/.bashrc"
    regexp: '^export GPG_TTY='
    line: 'export GPG_TTY=$(tty)'

- name: Install pinentry
  become: true
  ansible.builtin.package:
    name: pinetry

# eval "$(gpg-agent --daemon)" > /dev/null # Enable gpg-agent on startup
    # alias gpg-add= echo | gpg -s > dev/null
